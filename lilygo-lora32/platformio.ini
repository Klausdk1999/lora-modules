; PlatformIO Project Configuration File
; LilyGo T-Beam AXP2101 v1.2 - River Level Monitoring Node
; 
; Board: T-Beam AXP2101 v1.2 (FCC ID: 2asye-t-beam)
; This configuration was tested and verified to work with the LoRaWAN LMIC library.

[env:ttgo-t-beam]
platform = espressif32
board = ttgo-t-beam
framework = arduino

; Note: Board identifier changed from ttgo-lora32-v21 to ttgo-t-beam for T-Beam AXP2101 v1.2
; If you have a different LilyGo/TTGO board, you may need to use a different board definition:
; - ttgo-lora32-v1     (TTGO LoRa32-OLED V1)
; - ttgo-lora32-v2     (TTGO LoRa32-OLED V2)
; - ttgo-lora32-v21    (TTGO LoRa32-OLED v2.1.6)
; - ttgo-t-beam        (TTGO T-Beam) - USED FOR THIS PROJECT

; Serial Monitor settings
monitor_speed = 115200
monitor_filters = 
    default

; Library dependencies
lib_deps = 
    mcci-catena/MCCI LoRaWAN LMIC library@^4.1.1
    Wire

; Include the shared sensor library from parent folder
lib_extra_dirs = ../lib

; Add include paths for sensor libraries
build_flags = 
    ; Debug level for ESP32 core (3 = verbose, useful for troubleshooting)
    -DCORE_DEBUG_LEVEL=3
    
    ; Suppress LMIC project config header requirement
    ; This allows the code to compile without a custom hal/hal.h file
    -DARDUINO_LMIC_PROJECT_CONFIG_H_SUPPRESS
    
    ; Frequency band: AU915 (Australia/Brazil) - 915 MHz ISM band
    ; This must match the region where the gateway operates
    -DCFG_au915=1
    
    ; Radio module: SX1276/8 (Semtech LoRa transceiver)
    ; This matches the hardware on the T-Beam board
    -DCFG_sx1276_radio=1
    
    ; Disable LoRaWAN ping functionality (reduces code size and complexity)
    ; Ping is not needed for Class A devices that only send uplink data
    -DDISABLE_PING=1
    
    ; Disable LoRaWAN beacons (reduces code size and power consumption)
    ; Beacons are only used in Class B devices, not Class A
    -DDISABLE_BEACONS=1
    
    ; HAL air time bug workaround: Disabled (0) - not needed for ESP32
    ; This flag addresses timing issues on some platforms, but ESP32 handles it correctly
    -DHAL_AIR_TIME_BUG_WORKAROUND=0
    
    ; Disable long message support (messages > 51 bytes)
    ; Our payloads are small (SensorPayload struct), so this reduces code size
    -DLMIC_ENABLE_long_messages=0
    
    ; Disable DeviceTimeReq (reduces code size and complexity)
    ; Device time requests are optional and not needed for basic operation
    -DLMIC_ENABLE_DeviceTimeReq=0
    
    ; Rename hal_init to avoid conflict with ESP-IDF
    ; ESP-IDF has its own hal_init() function, so we rename LMIC's version
    -Dhal_init=lmic_hal_init
    
    ; Include path for sensor libraries
    -I../lib/sensors

; ============================================================================
; Build Flags (CRITICAL FOR LORAWAN OPERATION - DO NOT MODIFY WITHOUT TESTING)
; ============================================================================
; These flags were carefully selected to ensure proper LoRaWAN LMIC library
; operation on the ESP32. Changing these may cause compilation errors or
; runtime failures.

; Upload settings
upload_speed = 115200  ; Reduced speed for more reliable uploads (especially if in Secure Download Mode)



